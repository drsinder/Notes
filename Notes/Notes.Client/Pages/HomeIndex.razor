@page "/"
@page "/{EnterNotesfileId:int}"

@using System.Timers
@using Grpc.Net.Client
@using Microsoft.AspNetCore.Authorization
@using Notes.Client.Comp
@using Notes.Protos
@using Syncfusion.Blazor
@using Syncfusion.Blazor.DropDowns

@inject CookieStateAgent myState
@inject NavigationManager Navigation
@inject Blazored.SessionStorage.ISessionStorageService sessionStorage

@if (!(myState.IsAuthenticated))
{
    <CookieStateAgent @ref="myState" />
}
<PageTitle>Notes Index</PageTitle>

<h2 class="center">Welcome to Notes @myState?.UserInfo?.Displayname</h2>
<div>
    <h5 class="center">
        <Clock Interval="1000"></Clock>
    </h5>
    @if (!myState.IsAuthenticated)
    {
        <p class="center"><strong>You are not logged in.  Please log in.  Register first if you need to.</strong></p>
    }
    @if (hpData != null && !string.IsNullOrEmpty(hpData.Message))
    {
        <div>@((MarkupString)@hpData.Message)</div>
    }
    @if (myState.IsAuthenticated && hpData == null)
    {
        <p class="center"><em>Loading...</em></p>
    }
    else if (GoToFile.Id != 0)
    {
        <p class="center"><b>Click to goto: </b><FileButton NoteFile="@GoToFile"></FileButton></p>
    }

        else if (hpModel != null)
        {
             <div class="row">
                <div class="col-md-4"></div>
                <div class="col-md-4 roundedindex keep-center">
                    <EditForm Model="@dummyFile">
                        <ChildContent Context="Typer">
                            <p class="center">
                                <label>
                                    <strong>Enter a NoteFile Name and press Enter:</strong>
                                    <InputText class="form-control short-input"
                                               ValueChanged="@( (string val) => TextHasChanged(val) )"
                                               Value="@dummyFile.NoteFileName"
                                               ValueExpression="@( () => dummyFile.NoteFileName )" />
                                </label>
                            </p>
                            <p class="center">
                                Or select a file<br />
                                <div class="btn btn-file form-control short-input">
                                <SfDropDownList TValue="int" TItem="GNotefile" Placeholder="Select a File" DataSource="@fileList" >
                                    <DropDownListEvents TItem="GNotefile" TValue="int" ValueChange="@ValueChangeHandler" ></DropDownListEvents>
                                    <DropDownListFieldSettings Value="Id" Text="NoteFileName"></DropDownListFieldSettings>
                                </SfDropDownList>
                                </div>
                            </p>

                            <p class="center">
                                Or select a title<br />
                                <div class="btn btn-title form-control short-input">
                                <SfDropDownList TValue="int" TItem="GNotefile" Placeholder="Select a Title" DataSource="@nameList.List" >
                                    <DropDownListEvents TItem="GNotefile" TValue="int" ValueChange="@ValueChangeHandler" ></DropDownListEvents>
                                    <DropDownListFieldSettings Value="Id" Text="NoteFileTitle"></DropDownListFieldSettings>
                                </SfDropDownList> 
                                </div>
                            </p>
                        </ChildContent>
                    </EditForm>
                    <p class="center">
                        <a href="notesfiles"><strong>List of all NotesFiles</strong></a>
                    </p>
                </div>
            </div>

            <div class="row">
                <div class="col-md-2">
                </div>
                <div class="col-md-4">
                    <h4>Important Files</h4>
                    <ul>
                        @for (int i = 0; i < impfileList.List.Count; i++)
                        {
                             item = impfileList.List[i];
                            <li> 
                               <FileButton NoteFile="@item"></FileButton>
                            </li>
                        }
                    </ul>
                </div>
                <div class="col-md-4">
                    <h4>History Files</h4>
                    <ul>
                        @for (int i = 0; i < histfileList.List.Count; i++)
                        {
                             item = histfileList.List[i];
                            <li>
                               <FileButton NoteFile="@item"></FileButton>
                            </li>
                        }
                    </ul>
                </div>
            </div>

    } 


</div>

